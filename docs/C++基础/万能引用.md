# 万能引用
## 1 什么是万能引用？

**万能引用**是Scott Meyers在其《Effective Modern C++》一书中提出的术语，指的是模板中写成 `T&&` 的形式的参数，这种引用类型**既可以绑定左值，也可以绑定右值**，它也被称作*转发引用（Forwarding Reference）*。

简言之，万能引用是指**在模板类型推导上下文中，形如 `T&&` 的引用，它的绑定能力同时支持左值和右值。**

## 2 如何使用万能引用？
* 只有在**模板类型参数推导时**，函数参数类型写为 `T&&` 时，这样的引用才是万能引用。
* 普通的右值引用（非模板上下文或者类型已经指定时），只能绑定到右值。
* 万能引用在`std::forward`，完美转发中发挥核心作用。

```c++
template<typename T>
void func(T&& param){/**/};

int x = 42;
func(x);	// 传入左值，T推导为 int&， param类型为int& &&折叠为int&
// 若T推断为int,则为一个int&&右值引用，已知右值引用不能指向一个左值
// 但是int&可以接受一个int左值，因此可以将T解释为int&，从而param类型被推导为int& &&
func(42);	// 传入右值，T推导为 int， param类型为int&&

```

- 当传入左值`x`时，`T`推导为`int&`，因此`param`类型为`int& &&`，引用折叠规则让其变为`int&`（左值引用）。
- 当传入右值`42`时，`T`推导为`int`，`param`类型为`int&&`（右值引用）。

这就是万能引用的魅力，可以区分传入参数的值类别。

### 2.1 引用折叠规则
C++中引用折叠规则对万能引用的理解非常重要：无论左值引用和右值引用怎么“嵌套”，最终只会折叠成左值引用或者右值引用中的一种。

| 组合     | 折叠结果 |
| -------- | -------- |
| `T& &`   | `T&`     |
| `T& &&`  | `T&`     |
| `T&& &`  | `T&`     |
| `T&& &&` | `T&&`    |

在模板推导中，`T&&`的`T`可能是引用类型，折叠后类型决定了万能引用是左值引用还是右值引用。

```C++
void func(int&) {左值}
void func(int&&) {右值}

int main {
		Forward(10);
}

template <typename T>
	void Forward(T&& arg) {
		
		func(arg);
}

int&& arg
// 函数里面所有的参数都可以取地址；
// 函数里面都是左值
```
## 3 为什么要使用万能引用？